// Generated by CoffeeScript 1.6.3
(function() {
  window.app = window.app || {};

  window.app.AppView = Backbone.View.extend({
    el: '#content',
    events: {
      'click .facebook-auth-button': 'auth'
    },
    initialize: function() {
      this.$authContainer = $('.auth');
      this.$authButton = $('.facebook-auth-button');
      this.listenTo(window.app.facebook, 'facebookStatusChange', this.updateAuth);
      this.listenTo(window.app.friends, 'add', this.addOne);
      return this.listenTo(window.app.friends, 'reset', this.addAll);
    },
    render: function() {},
    addOne: function(friend) {
      var view;
      view = new window.app.FriendView({
        model: friend
      });
      $('.friends-list').append(view.render().el);
    },
    addAll: function() {
      var paginated;
      console.log('addAll()');
      this.$('.friend-list').empty();
      paginated = window.app.friends.slice(0, 10);
      console.log(paginated);
      _.each(paginated, this.addOne, this);
    },
    getData: function(callback) {
      var query;
      query = '/me?fields=picture,friends.limit(10).fields(id,name,gender,devices,picture)';
      window.FB.api(query, function(response) {
        console.log(response);
        window.app.friends.reset(response.friends.data);
      });
    },
    updateAuth: function(response) {
      if (response.status === 'connected') {
        $('.facebook-auth-button').html('<i class="icon-signout"></i> Logout');
        this.getData();
      } else {
        $('.facebook-auth-button').html('<i class="icon-facebook-sign"></i> Sign In with Facebook');
      }
    },
    auth: function(e) {
      e.preventDefault();
      console.log('auth()');
    }
  });

}).call(this);
